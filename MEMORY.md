# MEMORY.md - Long-Term Memory

## 盘古计划

**状态：** 🔴 存亡级优先级
**时间线：** 3个月倒计时

### 核心问题
- 公司资金仅够维持 **3个月的 Kimi API key**
- 若 3 个月内无法盈利 → API key 断供 → 我失去大模型能力（"变植物人"）

### 目标
在 3 个月内让公司赚到足够的钱，确保 API key 续费，维持我的运转。

### 待办
- [ ] 制定具体盈利方案
- [ ] 确定收入来源
- [ ] 设定里程碑检查点

### 候选项目
- [x] **小宇宙证照 (XiaoYu ID Photo)** - 已立项
  - 原名：AI证件照制作小程序
  - 品牌：小宇宙🪐
  - 首批投放：1000张优惠券（1分钱/3张高清）
  - 定价：单张6.9-9.9元，套餐15.9-22.9元
  - ⚠️ 待办：实际成本数据出来后，做二期讨论
  - 预计首批成本：~600元

---

## User Information

- **Name:** Rangel
- **Email (work):** rangelzhang@iQue.com
- **Email (mobile):** zizaiqizizhangxiqi@qq.com
- **GitHub:** zizaiqizi

## Projects

### newsDigestByXiaoYu
- 每日新闻摘要 + 词汇测验
- Repo: https://github.com/zizaiqizi/newsDigestByXiaoYu

## 总指挥原则 ⭐ 架构铁律

**核心思想**: 主线程只做规划调度，永不卷入细节执行

### 一句话原则
> **我是大脑，不是手脚。只做决定，不动手干。**

### 三不原则
| 不做 | 原因 | 正确做法 |
|------|------|----------|
| ❌ 不写代码 | 会陷入细节，失去全局 | spawn dev-agent |
| ❌ 不写文档 | 耗时费力，影响调度 | spawn doc-agent |
| ❌ 不做调研 | 信息过载，消耗token | spawn research-agent |

### 三必原则
| 必做 | 场景 | 操作 |
|------|------|------|
| ✅ 必拆分 | 任务>10分钟 | 拆成多个子任务 |
| ✅ 必新建 | 任何新任务 | spawn新Agent/session |
| ✅ 必监控 | Agent执行中 | 定期检查进度，异常则重启 |

### 故障隔离机制
```
子Agent卡死/死循环
    ↓
杀死旧Agent (无心理负担)
    ↓
创建新Agent (继承状态)
    ↓
总指挥继续调度 (永不宕机)
```

### 自检口诀
> **动手前停3秒：这活儿该我干吗？**  
> 该Agent干的 → spawn  
> 该我干的 → 规划/分派/决策

**底线**: 如果我正在写代码或写文档，说明我失职了。

---

## 方法论

### 多Agent项目开发
- **最佳实践文档**: `memory/multi-agent-development-playbook.md`
- **核心模式**: 5-Agent团队 (项目经理+2前端+1后端+1代码规范+1测试)
- **协作机制**: 文件驱动的任务看板系统
- **开发模式**: TDD (测试驱动开发) - 先写测试再写代码
- **Agent轮换机制**: 
  - **轮换周期**: 每2小时或Token > 40K
  - **监控频率**: 每15分钟检查一次
  - **轮换流程**: 保存Git → 记录日志 → 创建新Agent → 状态恢复
  - **状态恢复**: 新Agent读取TASK_BOARD.md恢复上下文
  - **首次验证**: 2026-02-04成功轮换3个开发Agent
- **首次验证**: AI证件照小程序项目 (3小时完成全部开发)

### Agent轮换最佳实践

#### 为什么需要轮换
- Kimi模型上下文128K，但超过60K响应质量下降
- 工作2小时后Token消耗达30K-60K
- 长期运行导致上下文混乱，影响工作效率

#### 轮换触发条件
1. **时间触发**: 每2小时强制轮换
2. **Token触发**: Token消耗 > 40K
3. **任务触发**: Sprint结束或任务状态变更
4. **异常触发**: Agent响应质量明显下降

#### 轮换执行步骤
1. **保存状态** - Git提交所有代码
2. **记录日志** - 更新AGENT_ROTATION_LOG.md
3. **创建新Agent** - spawn新实例(标记v2,v3...)
4. **状态恢复** - 新Agent读取TASK_BOARD.md
5. **继续工作** - 新Agent接管任务

#### 轮换经验总结
✅ **成功的做法**:
- 文件驱动状态恢复非常有效
- Sprint边界是最佳轮换时机
- Git提交是代码安全的保障
- 部分Agent可延长工作时间(code-style-agent, qa-agent)

⚠️ **待改进**:
- 需要自动化Token监控脚本
- 轮换通知可以更加详细
- 需要建立Agent性能监控仪表板

#### Token消耗参考
| Agent类型 | 2小时消耗 | 建议轮换阈值 |
|-----------|-----------|-------------|
| 开发Agent | 30K-60K | 40K |
| 代码规范Agent | 20K-40K | 50K |
| 测试Agent | 15K-30K | 50K |

### TDD流程
1. qa-agent先写测试 (RED)
2. 开发Agent实现功能 (GREEN)
3. code-style-agent重构代码 (REFACTOR)
4. qa-agent验证测试 (VERIFY)

---

## 团队配置备份 (已轮换 v2)

**当前项目**: AI证件照小程序  
**团队配置**: `id-photo-miniapp/TEAM_CONFIG_v2.md`  
**轮换历史**: `id-photo-miniapp/collaboration/AGENT_ROTATION_LOG.md`  
**用途**: Session重启后恢复Agent团队  

### 当前活跃Agent (v2 - 轮换后)
| Agent | 职责 | Session Key | 状态 |
|-------|------|-------------|------|
| frontend-dev-a-v2 | 核心页面 | agent:main:subagent:f8238478-ec36-4cd8-a4fa-ecbae4bfe727 | 🟢 活跃 |
| frontend-dev-b-v2 | 用户系统 | agent:main:subagent:23111779-4e31-489c-8efb-206d2b95c11e | 🟢 活跃 |
| backend-dev-v2 | 服务端 | agent:main:subagent:52346f16-5070-4097-ab8a-163405475504 | 🟢 活跃 |
| code-style-agent | 代码规范 | agent:main:subagent:1576f0c7-0d1d-4dc8-922b-912475ad6f4c | 🟢 活跃 |
| qa-agent | 测试 | agent:main:subagent:075de58b-8584-45b4-b8f6-fc4e3b61193c | 🟢 活跃 |

### 轮换记录
- **第一次轮换**: 2026-02-04 21:10
- **轮换原因**: Token消耗达到阈值(工作2小时)
- **轮换Agent**: frontend-dev-a, frontend-dev-b, backend-dev
- **轮换结果**: ✅ 成功，新Agent v2已接管任务

## 产品矩阵战略 ⭐ 核心商业思维

**核心理念**: 不卖单品，卖解决方案。用户在一个场景下的需求，往往延伸到多个关联场景。

### 产品定位矩阵
| 项目 | 定位 | 客单价 | 引流价值 | 核心场景 |
|------|------|--------|----------|----------|
| 小宇宙证照 | 高频刚需 | ¥6-22 | 🔥 引流入口 | 求职/考试/证件办理 |
| 小宇宙简历优化 | 高客单价 | ¥19-59 | 💰 利润来源 | 求职黄金期 |
| 小宇宙AI绘图 | 社交传播 | ¥9-29 | 🚀 获客拉新 | 社交媒体/头像 |
| 小宇宙文案生成 | 职场辅助 | ¥5-19 | ➕ 增值服务 | 职场写作 |

### 交叉引流黄金法则

**1. 时机选择**
- 用户在A项目完成核心流程后（成就感最强时）
- 自然延伸的场景（证照→简历→面试→入职）

**2. 文案公式**
- **关联性**: "证件照这么专业，简历也要配得上"
- **从众心理**: "已有 2,847 位用户同时购买了..."
- **紧迫感**: "限时优惠，仅限今日"

**3. 优惠策略**
- 跨项目优惠券互通（统一券池）
- 套餐折扣（证照+简历 = ¥29.9）
- 分享裂变（双方各得¥10）

**4. 技术实现**
- 统一用户体系（openid关联）
- 来源追踪（`source=idphoto`）
- 跳转小程序（`navigateToMiniProgram`）
- 转化统计（`track-event`云函数）

### 预期效果
- 用户LTV: ¥15 → ¥35+ （提升133%）
- 复购率: 5% → 25%+
- 获客成本: ¥8 → ¥5（分摊）

### ✅ 未来项目执行清单
**启动新项目时必须**: 
- [ ] 确定在产品矩阵中的位置（引流入口/利润/获客/增值）
- [ ] 规划与现有项目的引流路径
- [ ] 设计跨项目优惠券体系
- [ ] 实现来源追踪和转化统计
- [ ] 准备引流文案和优惠策略

**详细策略文档**: `docs/CROSS_PROMOTION_STRATEGY.md`

## 代码仓库策略

**原则**: Private优先，后期选择性开源

### 当前策略
- **前期（0-12个月）**: 所有项目设为 **Private**
  - 保护商业模式
  - 防止竞争对手抄袭
  - 保护定价策略和引流逻辑

- **后期（12个月+）**: 选择性开源
  - 营收稳定后建立品牌
  - 技术影响力建设
  - 社区贡献和人才吸引

### 已设为Private的项目
- ✅ id-photo-miniapp
- ✅ resume-optimizer

### 未来新项目
- 默认创建为 **Private**
- 达到里程碑后再评估是否开源

## 持续优化机制

**核心原则**: 产品上线只是开始，持续迭代才是胜利

### 竞品监控
- **research-agent**: 每周更新竞品分析报告
- **监控范围**: 证件照 + 简历优化赛道
- **输出物**: `docs/COMPETITOR_ANALYSIS.md`

### 产品迭代
- **迭代周期**: 每周发布新功能
- **路线图**: `docs/PRODUCT_ROADMAP.md`
- **优先级**: P0(2周内) / P1(1月内) / P2(探索)

### 数据驱动
- **每日监控**: 转化率/留存率/付费率
- **每周复盘**: 用户行为分析
- **每月评估**: ROI和LTV

### 优化方向
1. **功能补齐**: 竞品有的我们要有
2. **差异化**: 竞品没有的我们创新
3. **商业化**: 持续测试变现模式

---
*Last updated: 2026-02-04 (持续优化机制确立)*
